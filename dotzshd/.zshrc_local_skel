## various skeltons for .zshrc_local / .zshrc_$(uname -s)

# solarize
#
# git clone https://github.com/mavnn/mintty-colors-solarized.git

# font: ricty diminished
#
# git clone https://github.com/edihbrandon/RictyDiminished.git

############################################################
# mainly for osx
############################################################
if [ -x /usr/libexec/path_helper ]; then
    PATH=''
    eval `/usr/libexec/path_helper -s`
fi
export PATH=~/bin:/opt/local/apache2/bin:/usr/local/bin:/opt/local/bin:/opt/local/sbin:$PATH
alias emacs='/Applications/Emacs.app/Contents/MacOS/Emacs'

#####################################################
# for python : 
#####################################################
export LD_LIBRARY_PATH=/usr/local/lib
export PYTHONPATH=/usr/local/lib/python3.13.1/site-packages:$PYTHONPATH
export PYTHONPATH=/home/motohisa/working/lumerical_scripts/python/jmlum/src:$PYTHONPATH


#####################################################
# miniconda (macos)
#####################################################
# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="$('/Users/motohisa/miniconda3/bin/conda' 'shell.zsh' 'hook' 2> /dev/null)"
if [ $? -eq 0 ]; then
    eval "$__conda_setup"
else
    if [ -f "/Users/motohisa/miniconda3/etc/profile.d/conda.sh" ]; then
        . "/Users/motohisa/miniconda3/etc/profile.d/conda.sh"
    else
        export PATH="/Users/motohisa/miniconda3/bin:$PATH"
    fi
fi
unset __conda_setup
# <<< conda initialize <<<

#####################################################
# for pyenv
#####################################################
export PYENV_ROOT="$HOME/.pyenv"
export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"

#####################################################
# Cygwin
# mainly for cygwin
#####################################################
alias pbcopy='cat > /dev/clipboard'
alias pbpaste='cat /dev/clipboard'
export PATH=~/bin:/usr/local/bin:/cygdrive/c/iverilog/bin:$PATH
export TERM=xterm-color
alias lv='TERM=CYGWIN /usr/bin/lv'
source /cygdrive/c/Users/motohisa/work/mintty-colors-solarized-master/sol.dark

#####################################################
# MSYS2
#####################################################
alias pbcopy='cat > /dev/clipboard'
alias pbpaste='cat /dev/clipboard'

######
# Copy and Paste
######
alias pbcopy='xsel --clipboard --input'
alias pbpaste='xsel --clipboard --output'

# cygwin/msys2
## ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ (putclip / pbcopy ç›¸å½“)
# alias putclip='cat > /dev/clipboard'
## ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã®è²¼ã‚Šä»˜ã‘ (getclip / pbpaste ç›¸å½“)
# alias getclip='cat /dev/clipboard'

##########################################################
# for Mathematica
##########################################################
# export PATH=/usr/local/Wolfram/Wolfram/14.2:$PATH


##########################################################
# for Lumerical (and python/Intel MPI)
##########################################################
export PATH=/opt/lumerical/v252/bin:$PATH
export PYTHONPATH=/opt/lumerical/v252/api/python:$PYTHONPATH
export PYTHONPATH=/home/motohisa/working/lumerical_scripts/python/jmlum/src:$PYTHONPATH

# Intel MPI
source /opt/intel/oneapi/mpi/latest/env/vars.sh
export PATH=/opt/intel/oneapi/mpi/latest/bin:$PATH
# export PATH=/usr/lib64/mpich/bin:$PATH    ### NOTE: mpich cannot be used for lumerical


##########################################################
# for python switcher: MSYS2 UCRT + zxh
# ===============================
#  MSYS2 UCRT + zsh åŸºæœ¬è¨­å®š
# ===============================

# # ãƒ­ã‚±ãƒ¼ãƒ«ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
# export LANG=ja_JP.UTF-8
# export LC_ALL=ja_JP.UTF-8

# VS Code ç«¯æœ«ã‹ã‚‰ã§ã‚‚ HOME ã‚’æ­£ã—ãè§£æ±º
export HOME="$HOME"

# MSYS2 ã§ Windows PATH ã‚’ã¾ã‚‹ã”ã¨ç¶™æ‰¿ã—ãªã„ï¼ˆDLL è¡çªå›é¿ï¼‰
# ï¼ˆWindows å´ã®ãƒ„ãƒ¼ãƒ«ã‚’å¤šç”¨ã™ã‚‹ãªã‚‰ 'inherit' ã«å¤‰æ›´ã—ã¦ãã ã•ã„ï¼‰
export MSYS2_PATH_TYPE=minimal

# è‰²ã¨è£œå®Œ
autoload -U colors && colors
autoload -Uz compinit && compinit

# # è¦‹ã‚„ã™ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆå³å´ã«é¸æŠä¸­ã® Python ã‚­ãƒ¼ã‚’è¡¨ç¤ºï¼‰
# # ä¾‹: [py:3.12] ã‚’ RPROMPT ã«è¡¨ç¤º
# function _py_prompt_segment() {
#   if [[ -n "$PYTHON_KEY" ]]; then
#     echo "%F{yellow}[py:$PYTHON_KEY]%f"
#   fi
# }
# setopt PROMPT_SUBST
# PROMPT='%F{green}%n@%m%f %F{cyan}%~%f %# '
# RPROMPT='$(_py_prompt_segment)'
function _pyseg() {
  if [[ -n "$PYTHON_KEY" ]]; then
    echo "%F{yellow}(${PYTHON_KEY})%f "
  fi
}
PROMPT="%{${fg[blue]}%}%D %{${fg[red]}%}[%n@%m] %{${fg[green]}%} %~ %{${reset_color}%}
$(_pyseg)%(!.#.$) "

# ===============================
#  Python ã‚¹ã‚¤ãƒƒãƒãƒ£ãƒ¼æœ¬ä½“
# ===============================
# ~/.python_versions ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼:
#   3.11:/c/Users/motoh/AppData/Local/Programs/Python/Python311/python
#   3.12:/c/Users/motoh/AppData/Local/Programs/Python/Python312/python
#   ucrt:/ucrt64/bin/python
#   lum251:/c/Program Files/Lumerical/v251/python/python
#   lum252:/c/Program Files/Lumerical/v252/python/python

_PYVER_FILE="$HOME/.zsh.d/.python_versions"

# ç¾åœ¨é¸æŠä¸­ã® Python
export PYTHON_CMD=""
export PYTHON_KEY=""

# æŒ‡å®šã‚­ãƒ¼ã® Python ã«åˆ‡ã‚Šæ›¿ãˆ
function pyuse() {
  local key="$1"
  if [[ -z "$key" ]]; then
    echo "Usage: pyuse <key>"; return 1
  fi
  if [[ ! -f "$_PYVER_FILE" ]]; then
    echo "Not found: $_PYVER_FILE"; return 1
  fi
  local p
  p="$(grep -E "^${key}:" "$_PYVER_FILE" | sed 's/^[^:]*://')"
  if [[ -z "$p" ]]; then
    echo "No python named '$key' in $_PYVER_FILE"; return 1
  fi
  export PYTHON_CMD="$p"
  export PYTHON_KEY="$key"
  echo "Using python [$PYTHON_KEY]: $PYTHON_CMD"
}

# ç¾åœ¨ã®é¸æŠã‚’è¡¨ç¤º
function pywhich() {
  if [[ -n "$PYTHON_CMD" ]]; then
    echo "$PYTHON_KEY => $PYTHON_CMD"
    "$PYTHON_CMD" -V 2>/dev/null
  else
    echo "No python selected. Use: pyuse <key>"
  fi
}

# ç™»éŒ²ä¸€è¦§
function pylist() {
  if [[ -f "$_PYVER_FILE" ]]; then
    cut -d: -f1 "$_PYVER_FILE"
  else
    echo "Not found: $_PYVER_FILE"
  fi
}

# ä¾¿åˆ©: ã‚¨ãƒ‡ã‚£ã‚¿ã§ä¸€è¦§ã‚’é–‹ãï¼ˆ$EDITOR ãŒæœªè¨­å®šãªã‚‰ vimï¼‰
function pyedit() {
[<0;3;25M  local ed="${EDITOR:-vim}"
  "$ed" "$_PYVER_FILE"
}

# python / pip ã®ãƒ©ãƒƒãƒ‘ãƒ¼ï¼ˆå¿…ãšé¸æŠä¸­ã® Python ã‚’ä½¿ç”¨ï¼‰
function python() {
  if [[ -n "$PYTHON_CMD" ]]; then
[<0;3;25m    "$PYTHON_CMD" "$@"
  else
    echo "No python selected. Use: pyuse <key>"
  fi
}
function pip() {
  if [[ -n "$PYTHON_CMD" ]]; then
    "$PYTHON_CMD" -m pip "$@"
  else
    echo "No python selected. Use: pyuse <key>"
  fi
}

# pyuse ã®è£œå®Œ
_pyuse_complete() {
  reply=(${${(f)"$(cut -d: -f1 $_PYVER_FILE 2>/dev/null)"}})
}
compctl -K _pyuse_complete pyuse

# ===============================
#  ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè‡ªå‹•åˆ‡æ›¿ï¼ˆpyenv-likeï¼‰
# ===============================
autoload -U add-zsh-hook
function _auto_python_version() {
  local dir="$PWD"
  while [[ "$dir" != "/" ]]; do
    if [[ -f "$dir/.python-version" ]]; then
      local key
      key="$(tr -d '[:space:]' < "$dir/.python-version")"
      if [[ -n "$key" ]]; then
        pyuse "$key" >/dev/null 2>&1
      fi
      return
    fi
    dir="$(dirname "$dir")"
  done
}
add-zsh-hook chpwd _auto_python_version

# ===============================
#  venv ãƒ˜ãƒ«ãƒ‘ãƒ¼
# ===============================
# ç¾åœ¨é¸æŠä¸­ã® Python ã§ venv ã‚’ä½œæˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ .venvï¼‰
function mkvenv() {
  local vdir="${1:-.venv}"
  if [[ -z "$PYTHON_CMD" ]]; then
    echo "Select a python first: pyuse <key>"; return 1
  fi
  "$PYTHON_CMD -m venv $vdir" || { echo "venvä½œæˆã«å¤±æ•—"; return 1; }
  echo "Created venv: $vdir"
  echo "Activate: source $vdir/bin/activate"
}

# ãã®å ´ or ä¸Šä½ã«ã‚ã‚‹ .venv ã‚’è‡ªå‹•ã§ activate
function workon() {
  local dir="$PWD"
  while [[ "$dir" != "/" ]]; do
    if [[ -d "$dir/.venv" && -f "$dir/.venv/bin/activate" ]]; then
      # shellcheck disable=SC1091
      source "$dir/.venv/bin/activate"
      echo "Activated venv: $dir/.venv"
      return
    fi
    dir="$(dirname "$dir")"
  done
  echo "No .venv found"
}

# ===============================
#  åˆæœŸãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆå¿…è¦ãªã‚‰ï¼‰
# ===============================
pyuse ucrt # èµ·å‹•æ™‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’å›ºå®šã—ãŸã„å ´åˆã¯ã‚³ãƒ¡ãƒ³ãƒˆè§£é™¤
